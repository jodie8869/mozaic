function Point(){var a=Array.prototype.slice.call(arguments,0)[0];this._vals=[];this._k=0;this.init=function(){if(typeof a==="number"){this._k=a;for(var b=0;b<this._k;b+=1){this._vals.push(0)}}else{this._k=a.length;this._vals=a}};this.at=function(b){if(b>=this._k){throw"Point index out of range (index: "+b+",k: "+this._k+")"}return this._vals[b]};this.set=function(b,c){if(b>=this._k){throw"Point index out of range (index: "+b+",k: "+this._k+")"}this._vals[b]=c};this.equals=function(b){return(this===b)};this.lessThan=function(d){var b=true;for(var c=0;c<this._k;c+=1){b&=(this._vals[c]<d.at(c))}return b};this.toString=function(){return"("+this._vals.toString()+", "+this._k+")"}}function KDTree(){this._points=Array.prototype.slice.call(arguments,0)[0];this._k=Array.prototype.slice.call(arguments,1)[0];this._pointIndex=[];this.init=function(){var a=this._points.length;for(var b=0;b<a;b+=1){this._pointIndex.push(b)}this._buildTree(0,a,0)};this.findNearestNeighbor=function(e){if(this._points.length===0){return null}var h=0,a=this._points.length,g=0,b=Math.floor((h+a)/2),c=this._pointIndex[b],f=this._points[c];return this._nn(e,f,h,a,g)};this._buildTree=function(e,a,c){var b;if(a-e<=0){return}this._sort(e,a,c);b=Math.floor((e+a)/2);c=(c+1)%this._k;this._buildTree(e,b-1,c);this._buildTree(b+1,a,c)};this._sort=function(h,b,f){var g=this._pointIndex.slice(h,b),a=g.length,e=this;g.sort(function(i,d){return e._smallerDimVal(e._points[i],e._points[d],f)});for(var c=0;c<a;c+=1){this._pointIndex[h+c]=g[c]}};this._nn=function(k,g,c,h,m){var o=Math.floor((c+h)/2),f=this._pointIndex[o],n=this._points[f],j,a,b,i,e,l;if(typeof n==="undefined"){return g}if(h-c<=0){if(this._shouldReplace(k,g,n)){return n}return g}else{if(this._smallerDimVal(k,n,m)){g=this._nn(k,g,c,o-1,(m+1)%this._k);if(!this._shouldReplace(k,g,n)){return g}g=n;j=this._distance(k,g);a=Math.floor((o+1+h)/2);if(this._isInBounds(a)){i=this._pointIndex[a];l=this._distance(k,this._points[i]);if(l<j){g=this._nn(k,g,o+1,h,(m+1)%this._k)}}return g}else{g=this._nn(k,g,o+1,h,(m+1)%this._k);if(!this._shouldReplace(k,g,n)){return g}g=n;j=this._distance(k,g);b=Math.floor((c+o-1)/2);if(this._isInBounds(b)){e=this._pointIndex[b];l=this._distance(k,this._points[e]);if(l<j){g=this._nn(k,g,c,o-1,(m+1)%this._k)}}return g}}};this._smallerDimVal=function(e,c,f){return(e.at(f)<c.at(f))};this._shouldReplace=function(e,d,a){var b=this._distance(e,d);var c=this._distance(e,a);return(b===c)?a.lessThan(d):(c<b)};this._distance=function(d,c){var f=0;for(var e=0;e<this._k;e+=1){f+=(d.at(e)-c.at(e))*(d.at(e)-c.at(e))}return f};this._isInBounds=function(a){return((a>=0)&&(a<this._points.length))};this.toString=function(){var f="",b=this._pointIndex.length,g=0,a=b,c,e;if(a-g<=0){return"The tree is empty (>^.^)>"}for(var d=0;d<b;d+=1){c=this._pointIndex[d];e=this._points[c];f+=e.toString()+" "}return f}}function SourceCanvas(){this.width=0;this.height=0;this.src=0;this.data=[];this.init=function(f){var e=f.getContext("2d"),a,h;this.width=f.width;this.height=f.height;this.src=f.src;a=e.getImageData(0,0,this.width,this.height).data;h=a.length;for(var j=0;j<h;j+=4){var c=a[j];var k=a[j+1];var m=a[j+2];var d=new Point([c,k,m]);d.init();this.data.push(d)}};this.getPoint=function(a,c){if((a<0||a>=this.width)||(c<0||c>=this.height)){throw"x,y coordinates out of bounds <(*.*)>"}var b=(this.width*c)+a;return this.data[b]};this.toString=function(){var b="";if(this.width===0||this.height===0){return"Image has no width or height (>^.^<)"}for(var a=0;a<this.width;a+=1){for(var c=0;c<this.height;c+=1){b+=this.getPoint(a,c).toString()+" "}b+="\n"}return b}}function TileImage(){this._data=[];this._avgPoint=null;this._width=0;this._height=0;this.init=function(e,a,j){var b,m=0,f=0,h=0,k=0,d=0,g=0;this._data=e;this._width=a;this._height=j;b=this._data.length;for(var c=0;c<b;c+=1){m+=this._data[c][0];f+=this._data[c][1];h+=this._data[c][2]}k=Math.floor(m/b);d=Math.floor(f/b);g=Math.floor(h/b);this._avgPoint=new Point([k,d,g]);this._avgPoint.init()};this.getData=function(){return this._data};this.getAvgPoint=function(){return this._avgPoint};this.toString=function(){return this._avgPoint.toString()}}function Tiles(){this._tiles=[];this.init=function(f,e,a){var b=f.length;for(var d=0;d<b;d+=1){var c=new TileImage();c.init(f[d],e,a);this._tiles.push(c)}};this.getTiles=function(){return this._tiles};this.toString=function(){var a=this._tiles.length;var c="";for(var b=0;b<a;b+=1){c+=this._tiles[b].toString()+" "}return c}}(function(a){a.fn.mozaic=function(){var d=Array.prototype.slice.call(arguments,0),e=this,g,f,c=e[0],h,b;if(!e.is("canvas")){throw"Wrong tag for mozaic, please use it on a canvas (-I.I-)"}if(typeof d[0]!=="undefined"){g=d[0];if(typeof g.data==="string"){a.ajax({url:g.data,type:"GET",dataType:"json",async:false,success:function(i){f=i},error:function(i,j){if(j==="error"){throw"Error occured while reading the data file "+g.data}else{f=a.parseJSON(i.responseText.toString())}}})}else{f=g.data}}else{throw"Please provide a data set <(*.*<)"}h=new SourceCanvas();h.init(c);b=new Tiles();b.init(f.data,f.width,f.height);console.log(b.toString())}})(jQuery);